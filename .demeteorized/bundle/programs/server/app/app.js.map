{"version":3,"sources":["meteor://ðŸ’»app/server/main.js"],"names":[],"mappings":"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","file":"/app.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nLiveGames = new Mongo.Collection(\"liveGames\");\n\nMeteor.methods({\n    adjust_rating:function(new_rating){\n        var prof = Meteor.user().profile;\n        prof.rating = new_rating;\n\n        Meteor.users.update(Meteor.userId(), {$set: {profile: prof}});\n    },\n    set_challenge:function(opp_user){\n        var prof = Meteor.user().profile;\n        prof.challenge = opp_user._id;\n\n        Meteor.users.update(Meteor.userId(), {$set: {profile: prof}});\n\n        if(opp_user.profile.challenge === Meteor.userId()){\n        \tvar new_prof1 = Meteor.user().profile;\n        \tvar new_prof2 = opp_user.profile;\n        \tvar rand = Math.floor(Math.random() * 2);\n        \tvar colors = ['w','b'];\n        \tnew_prof1.challenge = null;\n        \tnew_prof1.game = colors[rand];\n        \tnew_prof1.opp_rating = opp_user.profile.rating;\n        \tnew_prof2.challenge = null;\n        \tnew_prof2.game = colors[1-rand];\n        \tnew_prof2.opp_rating = Meteor.user().profile.rating;\n\n        \tMeteor.users.update(Meteor.userId(), {$set: {profile: new_prof1}});\n        \tMeteor.users.update(opp_user._id, {$set: {profile: new_prof2}});\n\n        \tvar players = [opp_user._id, Meteor.userId()].sort();\n        \tvar new_game = {players: players, fen: \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\"};\n        \tLiveGames.upsert({players: players}, new_game);\n        }\n    },\n    update_board:function(new_fen, id){\n    \tLiveGames.update({players: id}, {$set: {fen: new_fen}});\n    },\n    game_over:function(wl){\n    \tvar prof = Meteor.user().profile;\n    \tvar opp_rating = prof.opp_rating;\n    \tprof.game = null;\n    \tprof.opp_rating = null;\n\n    \tif(!prof.rating) {\n    \t\tprof.rating = 1200;\n    \t}\n    \tif(!opp_rating) {\n    \t\topp_rating = 1200;\n    \t}\n\n    \t//adjust rating\n    \tvar expected = 1.0 / (1.0 + Math.pow(10, (opp_rating - prof.rating) / 400));\n    \tvar delta = Math.floor(32 * (wl - expected));\n    \tif(!prof.deltas) {\n    \t\tprof.deltas = [delta];\n    \t} else {\n    \t\tprof.deltas.unshift(delta);\n    \t\tif(prof.deltas.length > 10) {\n    \t\t\tprof.deltas.pop();\n    \t\t}\n    \t}\n    \tprof.rating += delta;\n\n    \tMeteor.users.update(Meteor.userId(), {$set: {profile: prof}});\n    \tLiveGames.remove({players: Meteor.userId()});\n    }\n});\n\nMeteor.publish(\"liveGames\", function(){\n    return LiveGames.find();\n});"]}